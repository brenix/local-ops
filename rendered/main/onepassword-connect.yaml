apiVersion: v1
kind: Secret
metadata:
  name: onepassword-connect-secret
  namespace: security
sops:
  age:
  - enc: |
      -----BEGIN AGE ENCRYPTED FILE-----
      YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBuL0tqTGRabjJjWTZNcllS
      THZqTVBlejNjdngvUTllWmt3MW1xb1A3b2prClNOazlTR3kvSG5zZ2JrejZFNDJQ
      SHlYdS9OTVZyNkFVZnpFYjhTQkExNG8KLS0tIFdUeEN6QThCeVN0VnRwZW8yRFc5
      N09IWGRyOFhLV0cya0dXUEJNWjVUd1UKs/VC92k6hNN1pWdv0wCRoOlNFAJyvagq
      6IDsgyu5gpfFOM9r6ICpN87MOqciKP1oRrjsRVVxrdPTNvitNBBeOA==
      -----END AGE ENCRYPTED FILE-----
    recipient: age1kky7jzc2x626xp4sfvpz7acytczqgdn7h2jxjqkjxzfd4kndcdxs8zr6ka
  azure_kv: []
  encrypted_regex: ^(data|stringData)$
  gcp_kms: []
  hc_vault: []
  kms: []
  lastmodified: "2024-04-18T03:08:21Z"
  mac: ENC[AES256_GCM,data:IoFcrO7WZ8YN4Vw8ZMTUNGrqiv18J3wm1VpMk2bqbO7K2p/xHbetQe6QT4H/Rt7SNU9t90SeJyuoKLZp4VkCV0FfTPT1HZwkWeQ2D4tEMmyuPhKo49Ay35yfmHUyHxtayerzt2Cc86Rarw6Zmquz5GAEXKQxyiYz7ox/d1pOaiA=,iv:MLLqlJZMECsFYiIFOxG11E6SkBtrg/5XlW1wcSx720o=,tag:4pT5mpcvZv8wJgO6DFFuww==,type:str]
  pgp: []
  version: 3.8.1
stringData:
  1password-credentials.json: ENC[AES256_GCM,data:jxPnKxqjqXnJGMYfaiewFzg9Vo8o0PO+yJmkPG4+/b1crzGDcSFkD+sl0c5Rx1XDs/lL8DYqBaFINT/zC8ixBiFCA3GjBM/zpELwEc8o6/yjGPET6/cl2I0fdcegTm8iJjLGSJ7kshxg0UrItmMaQxb8qplAH2WKGe6dVfBOSsUOPTR7XDR/Zh2GoEPCArRcO3zysbENWjCxQvFnQrkmoa/rYMgEnWgepy85jZP+SsKBE1/7fPofGKia4ZMoFE8Qvtdhl63MZA/MpUSUyYKDpdrjmKtQsGyCtOrgq4eHqMlSSbIaaCl9hER9bCVCWYV2Oh9QlNfIygWKdikOQ3s7/fjAkUpu5pKR5KHZv4LfLqCBxL34pyqbflGtLzwjN+ohyzgRy9bqr6WI/dhCFqYE8m9UaL8wL2l5LKVb7tql/M9TrNLd5gwBp37bsMYAQa5qqh+IMbxdH+r9ZHhOQxA32kUgTIylMsAuQKIvCfKszA7kF6chHFjb+DfVDuN/vb3RuXCdtau3abz0FM3uvhixXsDmFHl13yr3o1GiajeokhdKP6Yxg5fZg/E+EFdIfwe59pz0Au6RvOOvirb0qu85wLjZlwu1OUf9qqWNzf/m3PoAhgQCybmZWdUCZ2Tr7KLceEVlqSKhj5d2pX8cGeLUWD+uSEkOnlYcbZ8bifGJ7TUs6p+C8HCnAmIxWzJSUAUjT1g25cwIJXt7kK8+0bQYwTLwxzpG9qlAUxJxz7U6imYRo07khSmPOPCtqB5oaI7Kj/Pba5SWelsCzommhm/rH376VI93HKoaR0yrkdhcCp+wXAaTgb9e3cHL0YMyroxPdZZb40ybboY182+Qz2SSrHS7+bkJPpjo1IciIMV7hBVGLQ3nmR6aahevwfIrx8kzPkDEeOMQMAYlwZsNTtsid2eK5fNgI7Gqg4mL2rQBsopThE3+FWHlfZRP+osz7dPbdVS+hkAt4FjSD/fb413V34cpoS06yvbdx5VXsEifAGxIUtEmmOli7o/IBDHK5p+TfQSqTZZNP82coBtOMjzWYanOLA6VQOFctt+lz1B8WwIcAJUxlw+uqLhSuPuTrTOb7XTJNuM6iZFh50knRzXavDtcHCluaQfiN9hvraLvEMXADNCxeZgVsnzBk3/Xe3BrlMx9Yy6epMZYGyfOGFrQ9D/UT8GwxMBLE+ysmIDDtHzhwYopyhlLEw5qfmvPlDJygHfPMD2Vz6d8z+KYdTHc40MP5h35fv83TMycsBOPP9b3N6p8zPRdyUq8CrDcCae/Iv40fFnGPOpmi7U+tEqlxREdEx3Ygb0gYWtQRmfIqftdpOGu7Li69AI+42CxyUu+docAI88y1eo8YNKvm64Qv/3M4B+Zae7emjEVhhs9ObeH9dmOdO8m84T8N7pP/ztMJ6W3Gf9y5gmsTA4zzbciRIlnRAg3VYApo5RDrt2Q+Gduu1sQ1FZw6djmp/dXFW4rsCDFEgV58YmSrHgP+0vaiHIefpWIfqA1sCjgo7y7DtYCDokIX1FC8rSRVZHqNu7Nj5giYu0IGQJLbe64fNeZriF6fQ61XASgO4qeJj15AflEc3bD3x91bpK7l2R9pgjy270dA5yiV819Um7GZdxYrtTRMgShnjrPlDWitpcDFEFnfThx87tLTAtkpGGtMPyF2YmKjbgSKKs2qgD6QDYLCnewrb3XXJ26NGc7mSECJJn3oEKeQRRjWXjWVDo11RcqxF4vxwqW2t7TLVlmkWgqq7ZtXgOFcgSWW43EXVUK/ea7Zp4nJX82tSfVBQLwdRDXMdAQcrCBWmRhV24yhW9wfx+T/hp7KpytQ5qfYQwa+Sm2rBpNibuXt6fx7okg++NEGNpqi6oxuYyFU9GqL/vPXRFvTGInFDX8j3HpUJsknTC1wmbwu0t5POLx7MQfWMEjaz/FxFvauX7GNTeH,iv:NKMAp+Em5ZNIW+8QC9cDWxGrMoSCO9j6mp3YCnTNFWo=,tag:405B98qc3Muy2eLB1knsaA==,type:str]
  token: ENC[AES256_GCM,data:hXfIJbkgTIevxUroxCFtmTGl0Fpf9F2PAXQq8+f1+njvIi6Ih4ZoHBo954+t4IOfjOrLntfeSn/hPlCVMdP4e6tiGHRBcaB5GfSIPqNFRH9fb7A7vi5Y0bDY6f/V8treREHafwmQlDJe+qzHn+cTMnxQkR50jRh4attpCndDS4ucRiR//HogXONxqGOR/Zl4ElJQuaxrIQrjyAQHVOEOioTkkpT7wio/CHX1DfLxNCMrecG0Bp9Cj+FBlgNy8zogn5k577Kkxu9lyd93vN6mHbP7fsyBPsMTqpbm2zQ14fVSIhRfpOOhB5C1rpdUw2sWs8QQsJ/1moMjyPOq/wWWZ2z/wOfd9CZTUwA9SO222JN6vlndGjKWwSxQOT05e5kcusBpfRfmfZOrIi3pT6L3WIuCMV6kpdrHqaBg9QWsybar9AzAyiwSs5YKRAZ8DSgLuvGNdF0qwpmOb4PubChOqFQfz8fMwcNOyUJ30W8KZuyNQOq2oLXE0JsG4vwTABDI45mj7dIYSh8J1xE5wnNyxdIyop+CiLDh5SAa0iJbtoB5C7vagmEi4Uh57fYFcw1MPfl2ERbTieQPvrztaKPEILjNEJ7Ughy1nZVvhsGoGEG8KGx620Nbu2LOqFsno9pdZ4jt4SKs/o2nturk54OYTUuvBje10GrAuU5atRzvn3x6Y/s2t4IYfIh9/dNt36cjfHK+r4Lr5YIDIWr0r97sEn8sQu420RXGp3766AwmaqqWr7lSYKYOYNtGve/7MV0MYBNUM1+gXuuFB24HvBD4oHpsCkobXKq0nHlt0W+/sttEPZpZADpz2jQmdiNFX65CH92AoelhgRs9ofBawj7We+IL,iv:n8xj/DkaviMj62p1LUV+ZmQEaGsVLmYuCxppeihsQI0=,tag:+9V5qub/LPGr5zdQ7j2qyQ==,type:str]
---
apiVersion: v1
kind: Service
metadata:
  annotations:
    metallb.universe.tf/loadBalancerIPs: 192.168.2.12
  labels:
    app.kubernetes.io/component: connect
    app.kubernetes.io/instance: onepassword-connect
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connect
    app.kubernetes.io/version: 1.7.3
    helm.sh/chart: connect-1.16.0
  name: onepassword-connect
  namespace: security
spec:
  ports:
  - name: connect-sync
    port: 8081
  - name: connect-api
    port: 8080
  selector:
    app: onepassword-connect
  type: LoadBalancer
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: connect
    app.kubernetes.io/instance: onepassword-connect
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: connect
    app.kubernetes.io/version: 1.7.3
    helm.sh/chart: connect-1.16.0
  name: onepassword-connect
  namespace: security
spec:
  replicas: 1
  selector:
    matchLabels:
      app: onepassword-connect
  template:
    metadata:
      labels:
        app: onepassword-connect
        app.kubernetes.io/component: connect
        version: 1.7.3
    spec:
      containers:
      - env:
        - name: OP_SESSION
          valueFrom:
            secretKeyRef:
              key: 1password-credentials.json
              name: onepassword-connect-secret
        - name: OP_BUS_PORT
          value: "11220"
        - name: OP_BUS_PEERS
          value: localhost:11221
        - name: OP_HTTP_PORT
          value: "8080"
        - name: OP_LOG_LEVEL
          value: info
        image: 1password/connect-api:1.7.3
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /heartbeat
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 30
        name: connect-api
        readinessProbe:
          httpGet:
            path: /health
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 15
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 999
          runAsUser: 999
        volumeMounts:
        - mountPath: /home/opuser/.op/data
          name: shared-data
      - env:
        - name: OP_HTTP_PORT
          value: "8081"
        - name: OP_SESSION
          valueFrom:
            secretKeyRef:
              key: 1password-credentials.json
              name: onepassword-connect-secret
        - name: OP_BUS_PORT
          value: "11221"
        - name: OP_BUS_PEERS
          value: localhost:11220
        - name: OP_LOG_LEVEL
          value: info
        image: 1password/connect-sync:1.7.3
        imagePullPolicy: IfNotPresent
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /heartbeat
            port: 8081
            scheme: HTTP
          initialDelaySeconds: 15
          periodSeconds: 30
        name: connect-sync
        readinessProbe:
          httpGet:
            path: /health
            port: 8081
          initialDelaySeconds: 15
        resources: {}
        securityContext:
          allowPrivilegeEscalation: false
          runAsGroup: 999
          runAsUser: 999
        volumeMounts:
        - mountPath: /home/opuser/.op/data
          name: shared-data
      tolerations: []
      volumes:
      - emptyDir: {}
        name: shared-data
      - name: credentials
        secret:
          secretName: onepassword-connect-secret
