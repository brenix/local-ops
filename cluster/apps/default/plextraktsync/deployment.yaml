---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: &app plextraktsync-watch
  namespace: default
spec:
  template:
    spec:
      automountServiceAccountToken: false
      restartPolicy: OnFailure
      containers:
        - name: plextraktsync
          image: ghcr.io/taxel/plextraktsync:0.22.1@sha256:70ebd7fcbe4b13364342a19b8e1923b0487e105385bb4227f001a5651dc589fc
          args:
            - watch
          envFrom:
            - secretRef:
                name: *app
          volumeMounts:
            - name: config
              mountPath: /app/config/config.yml
              subPath: plextraktsync.yaml
              readOnly: true
            - name: pytrakt
              mountPath: /app/config/.pytrakt.json
              subPath: .pytrakt.json
              readOnly: false
      volumes:
        - name: config
          configMap:
            name: *app
        - name: pytrakt
          secret:
            secretName: plextraktsync-pytrakt
