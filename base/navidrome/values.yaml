controllers:
  main:
    containers:
      main:
        image:
          repository: ghcr.io/navidrome/navidrome
          tag: 0.53.3
          pullPolicy: Always
        env:
          TZ: America/Los_Angeles
          PUID: "1000"
          PGID: "100"
          ND_SCANSCHEDULE: 12h
          ND_SESSIONTIMEOUT: 24h
          ND_LOGLEVEL: info
          ND_ENABLETRANSCODINGCONFIG: "false"
          ND_TRANSCODINGCACHESIZE: 512MB
          ND_ENABLESTARRATING: "false"
          ND_ENABLEFAVOURITES: "false"

service:
  main:
    controller: main
    type: LoadBalancer
    annotations:
      metallb.universe.tf/loadBalancerIPs: 192.168.2.17
    externalTrafficPolicy: Local
    ports:
      http:
        port: 4533

ingress:
  main:
    className: external
    annotations:
      external-dns.alpha.kubernetes.io/target: external.brenix.com
    hosts:
    - host: &host "music.brenix.com"
      paths:
      - path: /
        service:
          identifier: main
          port: http
    tls:
    - hosts: [*host]

persistence:
  config:
    enabled: true
    type: persistentVolumeClaim
    accessMode: ReadWriteOnce
    size: 1Gi
    globalMounts:
    - path: /data
  music:
    enabled: true
    type: hostPath
    hostPathType: Directory
    hostPath: /media/music
    globalMounts:
    - path: /music
